var ApiAlarmIntegration={};ApiAlarmIntegration=ApiAlarmIntegration||{},ApiAlarmIntegration.FetchAlarms=function(a){function t(){a(document).on("ready",function(){a('[data-api-alarm-integration="load"]').each(function(t,e){this.init(e),a(e).removeAttr("data-api-alarm-integration")}.bind(this)),a(document).on("click",'[data-action="api-alarm-integration-load-more"]',function(a){this.loadMore(a.target)}.bind(this))}.bind(this))}return t.prototype.init=function(t){var e=a(t),r=e.attr("data-alarm-api"),n=e.attr("data-alamrs-per-page"),i=e.attr("data-alamrs-current-page");this.loadAlarms(t,r,n,i)},t.prototype.loadAlarms=function(t,e,r,n){var i=e+"wp/v2/alarm",l={per_page:r,page:n+1},o=ApiAlarmIntegration.Helper.Template.render("api-alarm-integration-loading");a(t).append(o),a.getJSON(i,l,function(e){a.each(e,function(e,r){a(t).find("[data-alarms-loading]").remove(),this.addAlarmToList(t,r)}.bind(this)),a(t).find("[data-api-alarms-load-more]").remove();var r=ApiAlarmIntegration.Helper.Template.render("api-alarm-integration-load-more");a(t).append(r)}.bind(this))},t.prototype.loadMore=function(t){var e=a(t).parents(".alarms-container"),r=e.attr("data-alarm-api"),n=e.attr("data-alamrs-per-page"),i=e.attr("data-alamrs-current-page")+1;e.attr("data-alamrs-current-page",i),a(t).closest("[data-api-alarms-load-more]").remove(),this.loadAlarms(e,r,n,i)},t.prototype.addAlarmToList=function(t,e){var r=new Date(e.date);e.date=r.toLocaleFormat("%Y-%m-%d %H:%M");var n=ApiAlarmIntegration.Helper.Template.render("api-alarm-integration-row",e);a(t).append(n)},new t}(jQuery),ApiAlarmIntegration=ApiAlarmIntegration||{},ApiAlarmIntegration.Helper=ApiAlarmIntegration.Helper||{},ApiAlarmIntegration.Helper.Template=function(){function Template(){this.getTemplates()}var _templates=[];return Template.prototype.render=function(key,data){var template=_templates[key];return template=template.replace(/{{\s*([\w\.]+)\s*}}/g,function(a,t){for(var e=data,r=t.split("."),n=0;n<r.length;n++)e=e[r[n]];return e}),template=template.replace(/{%\s*if(.*)\s*%}([\s\S]*?){%\s*endif\s*%}/gm,function($1,$2,$3){return eval($2)?$3:""})},Template.prototype.getTemplates=function(){for(var a=document.querySelectorAll("[data-template]"),t=0;t<a.length;t++){var e=a[t],r=e.getAttribute("data-template"),n=e.outerHTML.replace(/data-template="([^\"]*)"/gi,"");_templates[r]=n,e.parentElement.removeChild(e)}},new Template}();